#!/bin/bash
echo "[1]  stopping wpa supplicant"     &&
rm /var/run/wpa_supplicant/wlan0        &&
kill $(pgrep wpa_supplicant)            &&
#PID=$(pgrep dhcpcd)                             &&
#echo "[2]  killing dhcpcd PID $PID"     &&
#kill $PID                   &&
#echo "[3]  killing all dhcpcd PIDs"             &&
#kill $(pgrep dhcpcd)                &&
echo "[4]  bringing down dev wlan0"         &&
ip link set wlan0 down              &&
echo "[  wireless network is down  ]"

DEV="wlan0"
DRVR="nl80211"
#DRVR="wext"
CONF='/etc/wpa_supplicant/wpa_supplicant.conf'
echo "[1]  bringing up device $DEV"         &&
ip link set $DEV up                 &&
echo "[2]  loading wpa configuration"           &&
wpa_supplicant -B -D $DRVR -i $DEV -c $CONF     &&
#echo "[3]  starting dhcpcd service"         &&
#dhcpcd wlan0 -t 0                   &&
echo "[3]  running dhcp client"         &&
dhclient wlan0                      &&
echo "[   wireless network is up   ]"
