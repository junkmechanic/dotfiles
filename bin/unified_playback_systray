#!/usr/bin/env python

import gtk
import os

class StatusIcon:
    def __init__(self):
        self.statusicon = gtk.StatusIcon()
        self.statusicon.set_from_icon_name("lxmusic")
        self.statusicon.set_tooltip("Unified Playback")

        self.statusicon.connect("activate", self.left_click_event)
        self.statusicon.connect("popup-menu", self.right_click_event)

    def right_click_event(self, icon, button, time):
        menu = gtk.Menu()

        play_img = gtk.Image()
        play_img.set_from_icon_name('player_play', 1)
        play = gtk.ImageMenuItem('Play')
        play.set_image(play_img)

        change_img = gtk.Image()
        change_img.set_from_icon_name('object-flip-horizontal', 1)
        change = gtk.ImageMenuItem('Change')
        change.set_image(change_img)

        status_img = gtk.Image()
        status_img.set_from_icon_name('stock_text_justify', 1)
        status = gtk.ImageMenuItem('Status')
        status.set_image(status_img)

        about = gtk.ImageMenuItem(gtk.STOCK_ABOUT)
        quit = gtk.ImageMenuItem(gtk.STOCK_QUIT)

        change.connect("activate", self.change_media_player)
        play.connect("activate", self.play_media_player)
        status.connect("activate", self.show_current_status)
        about.connect("activate", self.show_about_dialog)
        quit.connect("activate", gtk.main_quit)

        menu.append(play)
        menu.append(change)
        menu.append(status)
        menu.append(about)
        menu.append(quit)

        menu.show_all()

        menu.popup(None, None, gtk.status_icon_position_menu, button, time, self.statusicon)

    def change_media_player(self, event):
        os.system('unified_playback --change')

    def play_media_player(self, event):
        os.system('unified_playback')

    def left_click_event(self, event):
        os.system('unified_playback')

    def show_current_status(self, event):
        os.system('current_song')

    def show_about_dialog(self, widget):
        about_dialog = gtk.AboutDialog()

        about_dialog.set_destroy_with_parent(True)
        about_dialog.set_program_name("Current Song Tint2 SysTray Icon")
        about_dialog.set_version("0.1")
        about_dialog.set_comments('A simple system tray icon to show the songs'
                                  ' being played by the active players via '
                                  'notification.\n\nDesigned specifically for '
                                  'tint2 and Openbox.\n\nYou will need the '
                                  '"current_song" script from .files/bin/.')
        about_dialog.set_authors(["junkmechanic, 2015 \nReleased under GPL v2 or later"])

        about_dialog.run()
        about_dialog.destroy()

StatusIcon()
gtk.main()
