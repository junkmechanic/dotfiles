#!/bin/bash

active_win_id=$(xprop -root | grep '^_NET_ACTIVE_W' | awk -F'# 0x' '{print $2}')
win_name=$(wmctrl -l | grep $active_win_id | awk '{print $4}' )
win_id=$(wmctrl -l | grep $active_win_id | awk '{print $1}' )

output='<openbox_pipe_menu>
'
output="$output"'<separator label="Current" />
<menu id="'"$win_id"'" label="'"$win_name"'" >
    <item label="Monitor Zap">
        <action name="Execute">
            <command>
                move-to-next-monitor '"$win_id"'
            </command>
        </action>
    </item>
</menu>
<separator label="All Windows" />
'
output="$output""$(wmctrl -l | while read window ; do
    win_name=$(echo $window | cut -d' ' -f4)
    win_id=$(echo $window | awk '{print $1}')
    [[ $win_name == "Conky" ]] && continue
    [[ $win_name == "tint2" ]] && continue
    echo '<menu id="'"$win_id"'" label="'"$win_name"'" >
    <item label="Monitor Zap">
        <action name="Execute">
            <command>
                move-to-next-monitor '"$win_id"'
            </command>
        </action>
    </item>
</menu>
'
done)"

output="${output}"'</openbox_pipe_menu>
'
printf '%s' "$output"
exit
